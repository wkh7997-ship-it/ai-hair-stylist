<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AI í—¤ì–´ ìŠ¤íƒ€ì¼ ê²°ê³¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
  :root {
    --primary: #9b8bff;
    --primary-strong: #5c6bff;
    --bg-deep: #050616;
    --bg-top: #11152b;
    --glass: rgba(10, 14, 32, 0.96);
    --text-main: #f9fafb;
    --text-sub: #cbd5f5;
    --border-soft: rgba(148, 163, 255, 0.35);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: radial-gradient(circle at top, #1d2545, #050616 60%);
    color: var(--text-main);
    padding: 16px;
  }

  .app {
    width: 100%;
    max-width: 540px;
    background: var(--glass);
    border-radius: 24px;
    border: 1px solid var(--border-soft);
    box-shadow: 0 24px 60px rgba(15, 23, 42, 0.8);
    padding: 20px 18px 24px;
    position: relative;
    overflow: hidden;
  }

  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }

  .title-main {
    font-size: 18px;
    font-weight: 700;
  }

  .title-sub {
    font-size: 11px;
    color: var(--text-sub);
  }

  .spinner-wrapper {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(6px);
    background: rgba(15, 23, 42, 0.6);
    z-index: 10;
  }

  .spinner-circle {
    width: 60px;
    height: 60px;
    border-radius: 999px;
    border: 2px solid rgba(148, 163, 255, 0.4);
    border-top-color: var(--primary-strong);
    display: flex;
    align-items: center;
    justify-content: center;
    animation: spin 1s linear infinite;
    position: relative;
  }

  .spinner-text {
    position: absolute;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 1px;
  }

  .spinner-label {
    margin-top: 10px;
    font-size: 11px;
    color: var(--text-sub);
    text-align: center;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .image-wrapper {
    margin-top: 14px;
    display: flex;
    justify-content: center;
  }

  /* âœ… ì—¬ê¸°ë§Œ í¬ê²Œ ë³€ê²½ë¨ */
  .result-img {
    width: 100%;              /* ì¹´ë“œ ê°€ë¡œ ê½‰ ì±„ìš°ê¸° */
    max-width: 480px;         /* íƒœë¸”ë¦¿ì—ì„œë„ ë„‰ë„‰í•˜ê²Œ */
    aspect-ratio: 3 / 4;
    border-radius: 20px;
    border: 1px solid rgba(148, 163, 255, 0.5);
    object-fit: cover;
    background: #020617;
    box-shadow: 0 18px 45px rgba(15, 23, 42, 0.9);
  }

  .style-name {
    margin-top: 10px;
    font-size: 15px;
    font-weight: 600;
    text-align: center;
  }

  .pager {
    margin-top: 4px;
    font-size: 11px;
    color: var(--text-sub);
    text-align: center;
  }

  .controls {
    margin-top: 12px;
    display: flex;
    justify-content: center;
    gap: 10px;
  }

  .nav-btn {
    padding: 8px 14px;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 255, 0.5);
    background: rgba(15, 23, 42, 0.9);
    color: var(--text-main);
    font-size: 12px;
    cursor: pointer;
  }

  .nav-btn:disabled {
    opacity: 0.4;
    cursor: default;
  }

  .bottom-links {
    margin-top: 16px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .link-button {
    width: 100%;
    padding: 10px;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 255, 0.5);
    background: rgba(15, 23, 42, 0.9);
    color: var(--text-sub);
    font-size: 12px;
    cursor: pointer;
    text-align: center;
  }
</style>

</head>
<body>
  <div class="app">
    <div class="header">
      <div>
        <div class="title-main">AI ìŠ¤íƒ€ì¼ ê²°ê³¼</div>
        <div class="title-sub">3ê°€ì§€ ìŠ¤íƒ€ì¼ì„ í•œ ì¥ì”© ë„˜ê²¨ë³´ì„¸ìš”.</div>
      </div>
    </div>

    <!-- SKINNER ìŠ¤íƒ€ì¼ ë¡œë”© -->
    <div class="spinner-wrapper" id="spinner">
      <div class="spinner-circle">
        <div class="spinner-text">SKINNER</div>
      </div>
      <div class="spinner-label">AIê°€ ìŠ¤íƒ€ì¼ì„ ì¤€ë¹„í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
    </div>

    <div class="image-wrapper">
      <img id="resultImg" class="result-img" alt="AI ìŠ¤íƒ€ì¼" />
    </div>
    <div class="style-name" id="styleName"></div>
    <div class="pager" id="pager"></div>

    <div class="controls">
      <button class="nav-btn" id="prevBtn">â† ì´ì „ ìŠ¤íƒ€ì¼</button>
      <button class="nav-btn" id="nextBtn">ë‹¤ìŒ ìŠ¤íƒ€ì¼ â†’</button>
    </div>

    <div class="bottom-links">
      <button class="link-button" onclick="window.location.href='/'">
        ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°
      </button>
      <button class="link-button" onclick="window.location.href='/products.html'">
        ğŸ’„ í—¤ì–´ì¼€ì–´ / ìŠ¤íƒ€ì¼ë§ ì¶”ì²œ ìƒí’ˆ ë³´ëŸ¬ê°€ê¸°
      </button>
    </div>
  </div>

  <script>
    const spinner = document.getElementById("spinner");
    const resultImg = document.getElementById("resultImg");
    const styleNameEl = document.getElementById("styleName");
    const pagerEl = document.getElementById("pager");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    let styles = [];
    let currentIndex = 0;

    function renderStyle() {
      if (!styles.length) return;
      const item = styles[currentIndex];
      resultImg.src = item.image;
      styleNameEl.textContent = item.name;
      pagerEl.textContent = `${currentIndex + 1} / ${styles.length}`;
      prevBtn.disabled = currentIndex === 0;
      nextBtn.disabled = currentIndex === styles.length - 1;
    }

    prevBtn.addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        renderStyle();
      }
    });

    nextBtn.addEventListener("click", () => {
      if (currentIndex < styles.length - 1) {
        currentIndex++;
        renderStyle();
      }
    });

    async function loadStyles() {
      const imageBase64 = localStorage.getItem("hair_image_base64");
      const gender = localStorage.getItem("hair_gender") || "female";
      const baseStyle = localStorage.getItem("hair_base_style") || "short";

      if (!imageBase64) {
        alert("ì‚¬ì§„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ì²˜ìŒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.");
        window.location.href = "/";
        return;
      }

      try {
        const res = await fetch("/api/hair-preview", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            image_base64: imageBase64,
            gender,
            base_style: baseStyle
          })
        });

        if (!res.ok) throw new Error("ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜");
        const data = await res.json();
        if (!data.success || !data.styles) throw new Error("AI ê²°ê³¼ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");

        styles = data.styles;
        currentIndex = 0;
        spinner.style.display = "none";
        renderStyle();
      } catch (err) {
        console.error(err);
        alert("ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        spinner.style.display = "none";
      }
    }

    loadStyles();
  </script>
</body>
</html>
