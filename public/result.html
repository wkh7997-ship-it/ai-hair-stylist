<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AI í—¤ì–´ ìŠ¤íƒ€ì¼ ê²°ê³¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --purple-top: #a855f7;
      --purple-bottom: #ec4899;
      --phone-bg: #f5f5f7;
      --text-main: #0f172a;
      --text-sub: #6b7280;
      --accent: #6366f1;
      --dark-bg: #020617;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 16px;
      background: linear-gradient(180deg, var(--purple-top), var(--purple-bottom));
      color: #ffffff;
    }

    .frame {
      width: 100%;
      max-width: 520px;
      border-radius: 28px;
      background: rgba(15, 23, 42, 0.2);
      box-shadow:
        0 20px 60px rgba(15, 23, 42, 0.7),
        0 0 0 1px rgba(148, 163, 255, 0.3);
      padding: 18px 18px 20px;
    }

    .header-text {
      text-align: center;
      margin-bottom: 14px;
    }

    .header-text h1 {
      font-size: 20px;
      font-weight: 800;
      letter-spacing: -0.04em;
      margin-bottom: 4px;
    }

    .header-text p {
      font-size: 12px;
      opacity: 0.9;
    }

    /* â€œí°â€ ì¹´ë“œ */
    .phone-wrap {
      margin: 12px auto 14px;
      max-width: 360px;
      border-radius: 34px;
      padding: 10px 10px 12px;
      background: linear-gradient(145deg, rgba(255,255,255,0.9), rgba(209,213,219,0.9));
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.4);
    }

    .phone-inner {
      border-radius: 26px;
      background: var(--phone-bg);
      padding: 10px 10px 14px;
      position: relative;
      overflow: hidden;
    }

    .phone-top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      padding: 0 4px;
    }

    .phone-back {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      background: #ffffff;
    }

    .phone-chip {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      font-size: 11px;
      background: #ffffff;
      color: var(--text-sub);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .phone-main-img-wrap {
      border-radius: 22px;
      overflow: hidden;
      background: #e5e7eb;
      aspect-ratio: 3 / 4;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    #mainImage {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .phone-caption {
      margin-top: 8px;
      text-align: center;
      color: var(--text-main);
    }

    .phone-caption-title {
      font-size: 14px;
      font-weight: 600;
    }

    .phone-caption-sub {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 2px;
    }

    /* ì¸ë„¤ì¼ ë¦¬ìŠ¤íŠ¸ */
    .thumb-strip {
      max-width: 420px;
      margin: 6px auto 0;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: nowrap;
    }

    .thumb-item {
      width: 70px;
      height: 70px;
      border-radius: 18px;
      overflow: hidden;
      border: 2px solid transparent;
      cursor: pointer;
      background: rgba(15, 23, 42, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .thumb-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .thumb-item.active {
      border-color: #f97316;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.5);
    }

    /* ì¸ë±ìŠ¤/ë„¤ë¹„ê²Œì´ì…˜ */
    .index-row {
      margin-top: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      font-size: 12px;
    }

    .nav-btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 255, 0.6);
      padding: 6px 12px;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.35);
      color: #e5e7eb;
      cursor: pointer;
    }

    .nav-btn:disabled {
      opacity: 0.4;
      cursor: default;
    }

    .index-dot-wrap {
      display: flex;
      gap: 4px;
      align-items: center;
    }

    .dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(249, 250, 251, 0.3);
    }

    .dot.active {
      width: 14px;
      background: #ffffff;
    }

    .index-text {
      font-size: 12px;
      opacity: 0.9;
    }

    /* í•˜ë‹¨ ë²„íŠ¼ë“¤ */
    .bottom-buttons {
      margin-top: 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .btn-wide {
      width: 100%;
      border-radius: 999px;
      padding: 11px;
      font-size: 13px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-primary {
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      border: 1px solid rgba(15, 23, 42, 1);
    }

    .btn-secondary {
      background: rgba(15, 23, 42, 0.15);
      color: #f9fafb;
      border: 1px solid rgba(248, 250, 252, 0.4);
    }

    .helper-text {
      margin-top: 6px;
      font-size: 10px;
      opacity: 0.85;
      line-height: 1.4;
      text-align: center;
    }

    /* ë¡œë”© ì˜¤ë²„ë ˆì´ */
    .loading-overlay {
      position: absolute;
      inset: 0;
      background: rgba(255, 255, 255, 0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 12px;
      color: var(--text-sub);
    }

    .spinner {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      border: 2px solid #e5e7eb;
      border-top-color: var(--accent);
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @media (max-width: 400px) {
      .frame {
        padding: 16px 14px 18px;
      }

      .phone-wrap {
        max-width: 340px;
      }
    }
  </style>
</head>
<body>
  <div class="frame">
    <div class="header-text">
      <h1>AI ìŠ¤íƒ€ì¼ ê²°ê³¼</h1>
      <p>ë‹¹ì‹ ì˜ ì–¼êµ´ì— ì–´ìš¸ë¦¬ëŠ” 3ê°€ì§€ ìŠ¤íƒ€ì¼ì„ í•œ ë²ˆì— í™•ì¸í•´ ë³´ì„¸ìš”.</p>
    </div>

    <!-- â€œí°â€ ì¹´ë“œ -->
    <div class="phone-wrap">
      <div class="phone-inner">
        <div class="phone-top-bar">
          <div class="phone-back" id="backFromPhone">â€¹</div>
          <div class="phone-chip">
            <span>AI ìŠ¤íƒ€ì¼ ë¯¸ë¦¬ë³´ê¸°</span>
          </div>
        </div>
        <div class="phone-main-img-wrap">
          <img id="mainImage" alt="í—¤ì–´ ìŠ¤íƒ€ì¼ ë¯¸ë¦¬ë³´ê¸°" />
          <div id="loadingOverlay" class="loading-overlay">
            <div class="spinner"></div>
            <div>AIê°€ ìŠ¤íƒ€ì¼ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤...</div>
          </div>
        </div>
        <div class="phone-caption">
          <div id="styleTitle" class="phone-caption-title">ìŠ¤íƒ€ì¼ 1 (í…ŒìŠ¤íŠ¸ìš©)</div>
          <div id="styleSub" class="phone-caption-sub">1 / 3</div>
        </div>
      </div>
    </div>

    <!-- ì¸ë„¤ì¼ 3ê°œ -->
    <div id="thumbStrip" class="thumb-strip"></div>

    <!-- ì¸ë±ìŠ¤ & ì´ì „/ë‹¤ìŒ -->
    <div class="index-row">
      <button id="prevBtn" class="nav-btn">â† ì´ì „ ìŠ¤íƒ€ì¼</button>
      <div class="index-dot-wrap">
        <div id="dot0" class="dot active"></div>
        <div id="dot1" class="dot"></div>
        <div id="dot2" class="dot"></div>
      </div>
      <button id="nextBtn" class="nav-btn">ë‹¤ìŒ ìŠ¤íƒ€ì¼ â†’</button>
    </div>

    <!-- í•˜ë‹¨ ë²„íŠ¼ -->
    <div class="bottom-buttons">
      <button class="btn-wide btn-primary" id="toProducts">
        ğŸ’„ í—¤ì–´ì¼€ì–´ Â· ìŠ¤íƒ€ì¼ë§ ì¶”ì²œ ìƒí’ˆ ë³´ëŸ¬ê°€ê¸°
      </button>
      <button class="btn-wide btn-secondary" id="toHome">
        ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°
      </button>
    </div>

    <div class="helper-text">
      * í˜„ì¬ëŠ” í…ŒìŠ¤íŠ¸ ë‹¨ê³„ë¡œ, ê°™ì€ ì‚¬ì§„ì´ 3ê°€ì§€ ìŠ¤íƒ€ì¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.<br />
      * ë‚˜ì¤‘ì— ì‹¤ì œ AI í—¤ì–´ ë³€í™˜ ëª¨ë¸ì´ ì—°ê²°ë˜ë©´, ìŠ¤íƒ€ì¼ë³„ë¡œ ë¨¸ë¦¬ ëª¨ì–‘ê³¼ ì»¬ëŸ¬ê°€ ë‹¬ë¼ì§‘ë‹ˆë‹¤.
    </div>
  </div>

  <script>
    const mainImage = document.getElementById("mainImage");
    const styleTitle = document.getElementById("styleTitle");
    const styleSub = document.getElementById("styleSub");
    const loadingOverlay = document.getElementById("loadingOverlay");
    const thumbStrip = document.getElementById("thumbStrip");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const toHome = document.getElementById("toHome");
    const toProducts = document.getElementById("toProducts");
    const backFromPhone = document.getElementById("backFromPhone");

    let stylesData = [];
    let currentIndex = 0;

    function updateView(index) {
      if (!stylesData.length) return;
      const style = stylesData[index];
      mainImage.src = style.image;
      styleTitle.textContent = style.name || `ìŠ¤íƒ€ì¼ ${index + 1}`;
      styleSub.textContent = `${index + 1} / ${stylesData.length}`;

      for (let i = 0; i < stylesData.length; i++) {
        const dot = document.getElementById("dot" + i);
        if (dot) dot.classList.toggle("active", i === index);
      }

      document.querySelectorAll(".thumb-item").forEach((el, i) => {
        el.classList.toggle("active", i === index);
      });

      prevBtn.disabled = index === 0;
      nextBtn.disabled = index === stylesData.length - 1;
    }

    function renderThumbs() {
      thumbStrip.innerHTML = "";
      stylesData.forEach((s, i) => {
        const div = document.createElement("div");
        div.className = "thumb-item" + (i === 0 ? " active" : "");
        div.innerHTML = `<img src="${s.image}" alt="ìŠ¤íƒ€ì¼ ${i + 1}" />`;
        div.addEventListener("click", () => {
          currentIndex = i;
          updateView(currentIndex);
        });
        thumbStrip.appendChild(div);
      });
    }

    async function loadStyles() {
      // ì¸ë±ìŠ¤ í˜ì´ì§€ì—ì„œ ì €ì¥í•´ ë‘” ê°’ ì½ì–´ì˜¤ê¸° (ë‘ ê°€ì§€ ì¼€ì´ìŠ¤ ëª¨ë‘ ì§€ì›)
      const baseImage =
        localStorage.getItem("hair_image_base64") ||
        localStorage.getItem("image_base64");

      const gender =
        localStorage.getItem("hair_gender") ||
        localStorage.getItem("gender") ||
        "ì—¬ì„±";

      const baseStyle =
        localStorage.getItem("hair_length") ||
        localStorage.getItem("base_style") ||
        "ì§§ìŒ";

      if (!baseImage) {
        alert("ë¨¼ì € ì‚¬ì§„ì„ ì—…ë¡œë“œí•´ ì£¼ì„¸ìš”.");
        window.location.href = "index.html";
        return;
      }

      try {
        const res = await fetch("/api/hair-preview", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            image_base64: baseImage,
            gender,
            base_style: baseStyle
          })
        });

        if (!res.ok) throw new Error("ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜");

        const data = await res.json();
        if (!data.success || !data.styles) {
          throw new Error("AI ê²°ê³¼ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }

        stylesData = data.styles;
        loadingOverlay.style.display = "none";
        renderThumbs();
        updateView(0);
      } catch (err) {
        console.error(err);
        loadingOverlay.innerHTML = `
          <div>ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>
          <div style="font-size:11px; margin-top:4px;">ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</div>
        `;
      }
    }

    // ë„¤ë¹„ê²Œì´ì…˜
    prevBtn.addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex -= 1;
        updateView(currentIndex);
      }
    });

    nextBtn.addEventListener("click", () => {
      if (currentIndex < stylesData.length - 1) {
        currentIndex += 1;
        updateView(currentIndex);
      }
    });

    toHome.addEventListener("click", () => {
      window.location.href = "index.html";
    });

    backFromPhone.addEventListener("click", () => {
      window.location.href = "index.html";
    });

    toProducts.addEventListener("click", () => {
      window.location.href = "products.html";
    });

    loadStyles();
  </script>
</body>
</html>
