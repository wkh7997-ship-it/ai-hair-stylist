<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AI í—¤ì–´ ìŠ¤íƒ€ì¼ëŸ¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --accent: #f97316;
      --accent-strong: #ea580c;
      --text: #f1f5f9;
      --text-sub: #94a3b8;
    }
    * { margin:0; padding:0; box-sizing:border-box; font-family:-apple-system, BlinkMacSystemFont, system-ui, sans-serif; }

    body {
      background:#0f172a;
      padding:16px;
      display:flex;
      justify-content:center;
      color:var(--text);
    }

    .app {
      width:100%;
      max-width:480px;
      background:#1e293b;
      border-radius:20px;
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    header { text-align:center; }
    header .title { font-size:20px; font-weight:600; }
    header .sub { font-size:12px; color:var(--text-sub); margin-top:4px; }

    .upload-box {
      background:#16203b;
      border:1px solid #334155;
      border-radius:18px;
      padding:16px;
      text-align:center;
      cursor:pointer;
    }

    .img-preview {
      width:100%;
      max-width:180px;
      margin:10px auto 0;
      border-radius:12px;
      border:1px solid #64748b;
      display:none;
      object-fit:contain;
    }
    #photoInput { display:none; }

    .section-title { font-size:14px; font-weight:600; margin-top:6px; }
    .select-group { display:flex; flex-wrap:wrap; gap:10px; }

    .select-btn {
      padding:8px 14px;
      border-radius:14px;
      border:1px solid #475569;
      background:#1e293b;
      color:var(--text-sub);
      cursor:pointer;
    }

    .select-btn.active {
      background:linear-gradient(135deg, var(--accent), var(--accent-strong));
      border:none;
      color:#fff;
    }

    .go-btn {
      padding:13px;
      border-radius:16px;
      border:none;
      background:linear-gradient(135deg, var(--accent), var(--accent-strong));
      color:#fff;
      font-size:15px;
      cursor:pointer;
      margin-top:4px;
    }

    /* ë¡œë”© ì˜¤ë²„ë ˆì´ */
    #loadingOverlay {
      display:none;
      position:fixed;
      top:0; left:0;
      width:100%; height:100%;
      background:rgba(0,0,0,0.55);
      backdrop-filter:blur(4px);
      z-index:9999;
      justify-content:center;
      align-items:center;
    }

    .loader {
      width:40px; height:40px;
      border:4px solid rgba(255,255,255,0.3);
      border-top-color:var(--accent);
      border-radius:50%;
      animation:spin 1s linear infinite;
    }

    @keyframes spin { to { transform:rotate(360deg); } }

  </style>
</head>
<body>

<!-- ë¡œë”© -->
<div id="loadingOverlay">
  <div>
    <div class="loader"></div>
    <p style="margin-top:10px; font-size:13px;">AIê°€ ìŠ¤íƒ€ì¼ ìƒì„± ì¤‘...</p>
  </div>
</div>

<div class="app">

  <header>
    <div class="title">AI í—¤ì–´ ìŠ¤íƒ€ì¼ëŸ¬</div>
    <div class="sub">ì…€ì¹´ í•œ ì¥ìœ¼ë¡œ ì–´ìš¸ë¦¬ëŠ” í—¤ì–´ìŠ¤íƒ€ì¼ì„ ì°¾ì•„ë³´ì„¸ìš”</div>
  </header>

  <div class="upload-box" onclick="document.getElementById('photoInput').click()">
    <div>ğŸ“· ì‚¬ì§„ ì—…ë¡œë“œ</div>
    <img id="preview" class="img-preview" />
    <input type="file" id="photoInput" accept="image/*" />
  </div>

  <div>
    <div class="section-title">ì„±ë³„</div>
    <div class="select-group">
      <div class="select-btn" data-value="female" onclick="toggleSelect(this,'gender')">ì—¬ì„±</div>
      <div class="select-btn" data-value="male" onclick="toggleSelect(this,'gender')">ë‚¨ì„±</div>
    </div>
  </div>

  <div>
    <div class="section-title">í˜„ì¬ ë¨¸ë¦¬ ê¸¸ì´</div>
    <div class="select-group">
      <div class="select-btn" data-value="short" onclick="toggleSelect(this,'hair')">ì§§ìŒ</div>
      <div class="select-btn" data-value="mid" onclick="toggleSelect(this,'hair')">ì¤‘ê°„</div>
      <div class="select-btn" data-value="long" onclick="toggleSelect(this,'hair')">ê¹€</div>
    </div>
  </div>

  <button class="go-btn" onclick="goNext()">AI ìŠ¤íƒ€ì¼ 3ê°€ì§€ ë³´ê¸°</button>

</div>

<script>
let uploadedImage = null;
let selectedGender = null;
let selectedHair = null;

document.getElementById("photoInput").addEventListener("change", (e)=>{
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = ev => {
    uploadedImage = ev.target.result;
    const img = document.getElementById("preview");
    img.src = uploadedImage;
    img.style.display = "block";
  };
  reader.readAsDataURL(file);
});

function toggleSelect(btn, type){
  const group = btn.parentNode.querySelectorAll(".select-btn");
  group.forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");

  if(type==="gender") selectedGender = btn.dataset.value;
  if(type==="hair") selectedHair = btn.dataset.value;
}

function goNext(){
  if(!uploadedImage){ alert("ì‚¬ì§„ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”."); return; }
  if(!selectedGender){ alert("ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }
  if(!selectedHair){ alert("ë¨¸ë¦¬ ê¸¸ì´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }

  sessionStorage.setItem("basePhoto", uploadedImage);

  document.getElementById("loadingOverlay").style.display = "flex";

  fetch("/api/hair-preview", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      image_base64: uploadedImage,
      gender: selectedGender,
      base_style: selectedHair
    })
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.success){
      sessionStorage.setItem("hairStyles", JSON.stringify(data.styles));
      window.location.href="/result.html";
    } else {
      alert("AI ë¶„ì„ ì‹¤íŒ¨");
      document.getElementById("loadingOverlay").style.display="none";
    }
  })
  .catch(()=>{
    alert("ì„œë²„ ì—°ê²° ì˜¤ë¥˜");
    document.getElementById("loadingOverlay").style.display="none";
  });
}
</script>

</body>
</html>
