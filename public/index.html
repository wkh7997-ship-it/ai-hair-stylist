<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AI í—¤ì–´ ìŠ¤íƒ€ì¼ëŸ¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg1: #020617;
      --bg2: #0f172a;
      --card: rgba(15, 23, 42, 0.6);
      --accent: #f97316;
      --accent-strong: #ea580c;
      --border: rgba(61, 77, 115, 0.45);
      --text: #f1f5f9;
      --text-sub: #94a3b8;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    }

    body {
      background: radial-gradient(circle at top, var(--bg1), var(--bg2) 65%);
      color: var(--text);
      padding: 14px;
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 480px;
      border-radius: 28px;
      background: rgba(15, 23, 42, 0.92);
      border: 1px solid rgba(51, 65, 85, 0.8);
      backdrop-filter: blur(18px);
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    header {
      text-align: center;
      padding: 6px 0 10px;
    }

    .app-title {
      font-size: 20px;
      font-weight: 600;
    }

    .app-sub {
      font-size: 12px;
      margin-top: 4px;
      color: var(--text-sub);
    }

    /* ì—…ë¡œë“œ ì˜ì—­ */
    .upload-box {
      background: var(--card);
      border: 1.2px solid var(--border);
      border-radius: 20px;
      padding: 16px 14px;
      text-align: center;
      cursor: pointer;
    }

    .upload-icon {
      font-size: 34px;
      margin-bottom: 8px;
      color: var(--accent);
    }

    .upload-text {
      font-size: 13px;
      margin-bottom: 8px;
    }

    .img-preview {
      width: 100%;
      max-width: 160px;
      margin: 8px auto;
      border-radius: 14px;
      border: 1px solid rgba(148,163,255,0.7);
      display: none;
      object-fit: contain;
    }

    #photoInput { display: none; }

    .upload-btn {
      margin-top: 8px;
      padding: 8px 12px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      border: 1px solid rgba(148,163,255,0.3);
      color: var(--text);
      font-size: 12px;
    }

    /* ì„ íƒ ë²„íŠ¼ */
    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin: 4px 0 6px;
    }

    .select-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .select-btn {
      padding: 8px 14px;
      border-radius: 14px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(148,163,255,0.25);
      font-size: 13px;
      color: var(--text-sub);
      cursor: pointer;
      transition: 0.15s;
    }

    .select-btn.active {
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: #fff;
      border-color: transparent;
      transform: scale(1.02);
    }

    /* ê²°ê³¼ ë³´ê¸° ë²„íŠ¼ */
    .go-btn {
      width: 100%;
      padding: 13px;
      font-size: 15px;
      border: none;
      border-radius: 16px;
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: #fff;
      box-shadow: 0 10px 24px rgba(248,113,22,0.45);
      cursor: pointer;
      font-weight: 600;
      margin-top: 10px;
    }

    /* ğŸ”¥ ë¡œë”© ì˜¤ë²„ë ˆì´ */
    #loadingOverlay {
      display: none;         /* â† í•µì‹¬ ìˆ˜ì • ì™„ë£Œ */
      position: fixed;
      z-index: 9999;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(5, 10, 25, 0.7);
      backdrop-filter: blur(4px);
      justify-content: center;
      align-items: center;
    }

    .loading-box {
      background: rgba(15, 23, 42, 0.92);
      padding: 20px 26px;
      border-radius: 18px;
      text-align: center;
      border: 1px solid rgba(148,163,255,0.2);
    }

    .loader {
      border: 4px solid rgba(255,255,255,0.15);
      border-top: 4px solid #f97316;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 0.9s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      font-size: 13px;
      color: #f1f5f9;
    }

  </style>
</head>
<body>

  <!-- ğŸ”¥ AI ë¡œë”© ìŠ¤í”¼ë„ˆ -->
  <div id="loadingOverlay">
    <div class="loading-box">
      <div class="loader"></div>
      <div class="loading-text">AIê°€ ìŠ¤íƒ€ì¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</div>
    </div>
  </div>

  <div class="app">

    <header>
      <div class="app-title">AI í—¤ì–´ ìŠ¤íƒ€ì¼ëŸ¬</div>
      <div class="app-sub">ì…€ì¹´ í•œ ì¥ìœ¼ë¡œ ì–´ìš¸ë¦¬ëŠ” í—¤ì–´ìŠ¤íƒ€ì¼ì„ ì°¾ì•„ë³´ì„¸ìš”</div>
    </header>

    <!-- ì‚¬ì§„ ì—…ë¡œë“œ -->
    <div class="upload-box" onclick="document.getElementById('photoInput').click()">
      <div class="upload-icon">ğŸ“·</div>
      <div class="upload-text">ì–¼êµ´ì´ ì˜ ë³´ì´ëŠ” ì‚¬ì§„ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”</div>

      <img id="preview" class="img-preview" />
      <div class="upload-btn">ì‚¬ì§„ ì„ íƒ</div>

      <input type="file" id="photoInput" accept="image/*" />
    </div>

    <!-- ì„±ë³„ -->
    <div>
      <div class="section-title">ì„±ë³„</div>
      <div class="select-group">
        <div class="select-btn" data-value="female" onclick="toggleSelect(this, 'gender')">ì—¬ì„±</div>
        <div class="select-btn" data-value="male" onclick="toggleSelect(this, 'gender')">ë‚¨ì„±</div>
      </div>
    </div>

    <!-- ë¨¸ë¦¬ ê¸¸ì´ -->
    <div>
      <div class="section-title">í˜„ì¬ ë¨¸ë¦¬ ê¸¸ì´</div>
      <div class="select-group">
        <div class="select-btn" data-value="short" onclick="toggleSelect(this, 'hair')">ë‹¨ë°œ / ì§§ì€ ë¨¸ë¦¬</div>
        <div class="select-btn" data-value="mid" onclick="toggleSelect(this, 'hair')">ì¤‘ê°„ ê¸¸ì´</div>
        <div class="select-btn" data-value="long" onclick="toggleSelect(this, 'hair')">ê¸´ ë¨¸ë¦¬</div>
      </div>
    </div>

    <!-- ë²„íŠ¼ -->
    <button class="go-btn" onclick="goNext()">AI ìŠ¤íƒ€ì¼ 3ê°€ì§€ ë³´ê¸°</button>

  </div>

  <script>
    let selectedGender = null;
    let selectedHair = null;
    let uploadedImage = null;

    /* ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° */
    document.getElementById("photoInput").addEventListener("change", function (e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (ev) {
          uploadedImage = ev.target.result;
          const preview = document.getElementById("preview");
          preview.src = uploadedImage;
          preview.style.display = "block";
        };
        reader.readAsDataURL(file);
      }
    });

    /* ë²„íŠ¼ ì„ íƒ */
    function toggleSelect(btn, type) {
      const group = btn.parentNode.querySelectorAll(".select-btn");
      group.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      if (type === "gender") selectedGender = btn.dataset.value;
      if (type === "hair") selectedHair = btn.dataset.value;
    }

    /* AI í˜¸ì¶œ */
    function goNext() {
      if (!uploadedImage) {
        alert("ì‚¬ì§„ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.");
        return;
      }
      if (!selectedGender) {
        alert("ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
      }
      if (!selectedHair) {
        alert("ë¨¸ë¦¬ ê¸¸ì´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
      }

      sessionStorage.setItem("basePhoto", uploadedImage);

      // ğŸ”¥ ë¡œë”© ì˜¤ë²„ë ˆì´ ì¼œê¸°
      document.getElementById("loadingOverlay").style.display = "flex";

      fetch("/api/hair-preview", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          image_base64: uploadedImage,
          gender: selectedGender,
          base_style: selectedHair
        })
      })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            sessionStorage.setItem("hairStyles", JSON.stringify(data.styles));
            window.location.href = "/result.html";
          } else {
            alert("AI ë¶„ì„ ì‹¤íŒ¨!");
            document.getElementById("loadingOverlay").style.display = "none";
          }
        })
        .catch(() => {
          alert("ì„œë²„ ì—°ê²° ì˜¤ë¥˜!");
          document.getElementById("loadingOverlay").style.display = "none";
        });
    }
  </script>

</body>
</html>
