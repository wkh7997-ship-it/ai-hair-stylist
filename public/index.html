<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AI í—¤ì–´ ìŠ¤íƒ€ì¼ëŸ¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg1: #020617;
      --bg2: #0f172a;
      --card: rgba(15, 23, 42, 0.6);
      --accent: #f97316;
      --accent-strong: #ea580c;
      --border: rgba(61, 77, 115, 0.45);
      --text: #f1f5f9;
      --text-sub: #94a3b8;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    }

    body {
      background: radial-gradient(circle at top, var(--bg1), var(--bg2) 65%, #000);
      color: var(--text);
      padding: 14px;
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 480px;
      border-radius: 28px;
      background: rgba(15, 23, 42, 0.92);
      border: 1px solid rgba(51, 65, 85, 0.8);
      backdrop-filter: blur(18px);
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    header {
      text-align: center;
      padding: 8px 0 12px;
    }

    .app-title {
      font-size: 20px;
      font-weight: 600;
    }

    .app-sub {
      font-size: 12px;
      margin-top: 4px;
      color: var(--text-sub);
    }

    /* ì—…ë¡œë“œ ì˜ì—­ */
    .upload-box {
      background: var(--card);
      border: 1.2px solid var(--border);
      border-radius: 20px;
      padding: 24px 18px; /* ì‚´ì§ ì¤„ì—¬ì„œ ë†’ì´ ê°ì†Œ */
      text-align: center;
    }

    .upload-icon {
      font-size: 36px;
      margin-bottom: 10px;
      color: var(--accent);
    }

    .upload-text {
      font-size: 14px;
      margin-bottom: 10px;
    }

    .img-preview {
      width: 100%;
      max-width: 240px;
      margin: 10px auto;
      border-radius: 16px;
      border: 1px solid rgba(148,163,255,0.7);
      display: none;
    }

    #photoInput {
      display: none;
    }

    .upload-btn {
      margin-top: 10px;
      padding: 9px 14px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      border: 1px solid rgba(148,163,255,0.3);
      color: var(--text);
      font-size: 13px;
      cursor: pointer;
    }

    /* ì„ íƒ ë²„íŠ¼ë“¤ */
    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin: 4px 0 8px;
    }

    .select-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .select-btn {
      padding: 9px 14px;
      border-radius: 14px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(148,163,255,0.25);
      font-size: 13px;
      color: var(--text-sub);
      cursor: pointer;
    }

    .select-btn.active {
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: #fff;
      border-color: transparent;
    }

    /* ê²°ê³¼ ë³´ê¸° ë²„íŠ¼ â€“ position: sticky ì œê±°, ìœ„ë¡œ ì‚´ì§ ì˜¬ë¦¼ */
    .go-btn {
      width: 100%;
      padding: 14px;
      font-size: 15px;
      border: none;
      border-radius: 16px;
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: #fff;
      box-shadow: 0 12px 28px rgba(248,113,22,0.45);
      cursor: pointer;
      font-weight: 600;
      margin-top: 18px; /* ì¡°ê¸ˆë§Œ ìœ„ë¡œ */
    }

  </style>
</head>
<body>
  <div class="app">

    <header>
      <div class="app-title">AI í—¤ì–´ ìŠ¤íƒ€ì¼ëŸ¬</div>
      <div class="app-sub">ì…€ì¹´ í•œ ì¥ìœ¼ë¡œ ì–´ìš¸ë¦¬ëŠ” í—¤ì–´ìŠ¤íƒ€ì¼ì„ ì°¾ì•„ë³´ì„¸ìš”</div>
    </header>

    <!-- ì‚¬ì§„ ì—…ë¡œë“œ ë°•ìŠ¤ -->
    <div class="upload-box" onclick="document.getElementById('photoInput').click()">
      <div class="upload-icon">ğŸ“·</div>
      <div class="upload-text">ì–¼êµ´ì´ ì˜ ë³´ì´ëŠ” ì‚¬ì§„ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”</div>

      <img id="preview" class="img-preview" />

      <div class="upload-btn">ì‚¬ì§„ ì„ íƒ</div>
      <input type="file" id="photoInput" accept="image/*" />
    </div>

    <!-- ì„±ë³„ ì„ íƒ -->
    <div>
      <div class="section-title">ì„±ë³„</div>
      <div class="select-group">
        <div class="select-btn" data-value="female" onclick="toggleSelect(this, 'gender')">ì—¬ì„±</div>
        <div class="select-btn" data-value="male" onclick="toggleSelect(this, 'gender')">ë‚¨ì„±</div>
      </div>
    </div>

    <!-- ë¨¸ë¦¬ ê¸¸ì´ ì„ íƒ -->
    <div>
      <div class="section-title">í˜„ì¬ ë¨¸ë¦¬ ê¸¸ì´</div>
      <div class="select-group">
        <div class="select-btn" data-value="short" onclick="toggleSelect(this, 'hair')">ë‹¨ë°œ / ì§§ì€ ë¨¸ë¦¬</div>
        <div class="select-btn" data-value="mid" onclick="toggleSelect(this, 'hair')">ì¤‘ê°„ ê¸¸ì´</div>
        <div class="select-btn" data-value="long" onclick="toggleSelect(this, 'hair')">ê¸´ ë¨¸ë¦¬</div>
      </div>
    </div>

    <!-- ê²°ê³¼ ë³´ê¸° ë²„íŠ¼ -->
    <button class="go-btn" onclick="goNext()">AI ìŠ¤íƒ€ì¼ 3ê°€ì§€ ë³´ê¸°</button>

  </div>

  <script>
    let selectedGender = null;
    let selectedHair = null;
    let uploadedImage = null;

    // ë¯¸ë¦¬ë³´ê¸°
    document.getElementById("photoInput").addEventListener("change", function (e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (ev) {
          uploadedImage = ev.target.result;
          const preview = document.getElementById("preview");
          preview.src = uploadedImage;
          preview.style.display = "block";
        };
        reader.readAsDataURL(file);
      }
    });

    // ì„ íƒ ë²„íŠ¼ í† ê¸€
    function toggleSelect(btn, type) {
      const group = btn.parentNode.querySelectorAll(".select-btn");
      group.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      if (type === "gender") selectedGender = btn.dataset.value;
      if (type === "hair") selectedHair = btn.dataset.value;
    }

    // ë‹¤ìŒ í˜ì´ì§€ ì´ë™ + AI í˜¸ì¶œ
    function goNext() {
      if (!uploadedImage) {
        alert("ì‚¬ì§„ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.");
        return;
      }
      if (!selectedGender || !selectedHair) {
        alert("ì„±ë³„ê³¼ ë¨¸ë¦¬ ê¸¸ì´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
      }

      sessionStorage.setItem("basePhoto", uploadedImage);

      fetch("/api/hair-preview", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          image_base64: uploadedImage,
          gender: selectedGender,
          base_style: selectedHair
        })
      })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            sessionStorage.setItem("hairStyles", JSON.stringify(data.styles));
            window.location.href = "/result.html";
          } else {
            alert("AI ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
          }
        })
        .catch(() => alert("ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
    }
  </script>
</body>
</html>
